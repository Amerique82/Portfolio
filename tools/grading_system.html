import { useState } from 'react';

export default function GradingSystem() {
  const [subjectName, setSubjectName] = useState('');
  const [components, setComponents] = useState([
    { id: 1, name: '', weight: '', grade: '' }
  ]);

  const addComponent = () => {
    if (components.length < 3) {
      setComponents([
        ...components,
        { id: Date.now(), name: '', weight: '', grade: '' }
      ]);
    }
  };

  const removeComponent = (id) => {
    if (components.length > 1) {
      setComponents(components.filter(c => c.id !== id));
    }
  };

  const updateComponent = (id, field, value) => {
    setComponents(components.map(c => {
      if (c.id === id) {
        if (field === 'name') {
          // All characters allowed, max 40 characters
          return { ...c, [field]: value.slice(0, 40) };
        }
        if (field === 'weight') {
          const num = parseFloat(value) || '';
          return { ...c, [field]: num === '' ? '' : Math.min(100, Math.max(0, num)) };
        }
        if (field === 'grade') {
          const num = parseFloat(value) || '';
          return { ...c, [field]: num === '' ? '' : Math.min(100, Math.max(0, num)) };
        }
        return { ...c, [field]: value };
      }
      return c;
    }));
  };

  const totalWeight = components.reduce((sum, c) => sum + (parseFloat(c.weight) || 0), 0);
  
  const weightedSum = components.reduce((sum, c) => {
    const weight = parseFloat(c.weight) || 0;
    const grade = parseFloat(c.grade) || 0;
    return sum + (weight * grade / 100);
  }, 0);

  const finalGrade = totalWeight > 0 ? (weightedSum / totalWeight) * 100 : 0;
  
  const isValidCalculation = components.some(c => c.weight && c.grade);

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-800 p-6">
      <div className="max-w-xl mx-auto">
        {/* Header */}
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-white mb-2">üìö Grading System</h1>
          <p className="text-purple-200 text-sm">Flexible grade calculator</p>
        </div>

        {/* Subject Name */}
        <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20">
          <label className="block text-purple-200 text-sm font-medium mb-2">
            Subject Name
          </label>
          <input
            type="text"
            value={subjectName}
            onChange={(e) => setSubjectName(e.target.value)}
            placeholder="E.g: Mathematics, Physics, etc."
            className="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/30 text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent transition-all"
          />
        </div>

        {/* Components */}
        <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-white font-semibold">Components</h2>
            <span className="text-purple-300 text-sm">{components.length}/3</span>
          </div>

          <div className="space-y-4">
            {components.map((component, index) => (
              <div 
                key={component.id} 
                className="bg-white/5 rounded-xl p-4 border border-white/10 hover:border-pink-400/50 transition-all"
              >
                <div className="flex justify-between items-center mb-3">
                  <span className="text-pink-300 font-medium text-sm">
                    Component {index + 1}
                  </span>
                  {components.length > 1 && (
                    <button
                      onClick={() => removeComponent(component.id)}
                      className="text-red-400 hover:text-red-300 text-sm transition-colors"
                    >
                      ‚úï Remove
                    </button>
                  )}
                </div>

                <div className="grid grid-cols-1 gap-3">
                  {/* Component Name */}
                  <div>
                    <label className="block text-purple-300 text-xs mb-1">
                      Name (max 40 characters)
                    </label>
                    <input
                      type="text"
                      value={component.name}
                      onChange={(e) => updateComponent(component.id, 'name', e.target.value)}
                      placeholder="E.g: Coursework 1, Final Test, etc."
                      className="w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-purple-400/60 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
                    />
                    <span className="text-purple-400 text-xs">{component.name.length}/40</span>
                  </div>

                  <div className="grid grid-cols-2 gap-3">
                    {/* Weight */}
                    <div>
                      <label className="block text-purple-300 text-xs mb-1">
                        Weight (%)
                      </label>
                      <div className="relative">
                        <input
                          type="number"
                          value={component.weight}
                          onChange={(e) => updateComponent(component.id, 'weight', e.target.value)}
                          placeholder="0"
                          min="0"
                          max="100"
                          className="w-full px-3 py-2 pr-8 rounded-lg bg-white/10 border border-white/20 text-white placeholder-purple-400/60 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
                        />
                        <span className="absolute right-3 top-1/2 -translate-y-1/2 text-purple-300 text-sm">%</span>
                      </div>
                    </div>

                    {/* Grade */}
                    <div>
                      <label className="block text-purple-300 text-xs mb-1">
                        Grade
                      </label>
                      <input
                        type="number"
                        value={component.grade}
                        onChange={(e) => updateComponent(component.id, 'grade', e.target.value)}
                        placeholder="0"
                        min="0"
                        max="100"
                        className="w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-purple-400/60 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent"
                      />
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>

          {/* Add Component Button */}
          {components.length < 3 && (
            <button
              onClick={addComponent}
              className="w-full mt-4 py-3 rounded-xl border-2 border-dashed border-purple-400/50 text-purple-300 hover:border-pink-400 hover:text-pink-300 transition-all flex items-center justify-center gap-2"
            >
              <span className="text-xl">+</span>
              Add Component
            </button>
          )}
        </div>

        {/* Results */}
        <div className="bg-gradient-to-r from-pink-500/20 to-purple-500/20 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
          <h2 className="text-white font-semibold mb-4 text-center">
            {subjectName || 'Results'}
          </h2>

          {/* Weight Summary */}
          <div className="bg-white/5 rounded-xl p-4 mb-4">
            <div className="flex justify-between items-center mb-2">
              <span className="text-purple-300 text-sm">Total Weight Used:</span>
              <span className={`font-bold ${totalWeight > 100 ? 'text-red-400' : 'text-white'}`}>
                {totalWeight.toFixed(1)}%
              </span>
            </div>
            {totalWeight > 100 && (
              <p className="text-red-400 text-xs">‚ö†Ô∏è Total weight exceeds 100%</p>
            )}
            {totalWeight < 100 && totalWeight > 0 && (
              <p className="text-yellow-400 text-xs">‚ÑπÔ∏è You are only using {totalWeight}% of total weight</p>
            )}
          </div>

          {/* Breakdown */}
          {isValidCalculation && (
            <div className="bg-white/5 rounded-xl p-4 mb-4">
              <h3 className="text-purple-200 text-sm mb-2">Breakdown:</h3>
              {components.map((c, i) => {
                if (!c.weight || !c.grade) return null;
                const contribution = (parseFloat(c.weight) * parseFloat(c.grade) / 100);
                return (
                  <div key={c.id} className="flex justify-between text-sm text-purple-300 py-1">
                    <span className="truncate mr-2">{c.name || `Component ${i + 1}`}</span>
                    <span className="text-white whitespace-nowrap">
                      {c.grade} √ó {c.weight}% = <span className="text-pink-300">{contribution.toFixed(2)}</span>
                    </span>
                  </div>
                );
              })}
              <div className="border-t border-white/10 mt-2 pt-2 flex justify-between text-sm">
                <span className="text-purple-300">Weighted Sum:</span>
                <span className="text-white font-medium">{weightedSum.toFixed(2)}</span>
              </div>
            </div>
          )}

          {/* Final Grade */}
          <div className="text-center">
            <div className="text-purple-300 text-sm mb-1">Final Grade</div>
            <div className={`text-5xl font-bold ${
              finalGrade >= 70 ? 'text-green-400' : 
              finalGrade >= 50 ? 'text-yellow-400' : 'text-red-400'
            }`}>
              {isValidCalculation ? finalGrade.toFixed(1) : '‚Äî'}
            </div>
            {isValidCalculation && (
              <div className="text-purple-300 text-sm mt-1">
                {finalGrade >= 70 ? '‚úÖ Passed' : 
                 finalGrade >= 50 ? '‚ö†Ô∏è At Risk' : '‚ùå Failed'}
              </div>
            )}
          </div>
        </div>

        {/* Footer */}
        <p className="text-center text-purple-300/60 text-xs mt-6">
          Formula: Œ£(weight √ó grade) / total weight √ó 100
        </p>
      </div>
    </div>
  );
}
